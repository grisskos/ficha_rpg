<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Criar Personagem</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root { --bg: #0f0f0f; --card: #1c1c1c; --primary: #e63946; --text: #f1f1f1; }
  body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 20px; display: flex; justify-content: center; }
  
  .container { width: 100%; max-width: 600px; }
  h1 { border-bottom: 2px solid var(--primary); padding-bottom: 10px; color: var(--primary); }
  
  .card { background: var(--card); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; }
  
  input { width: 100%; padding: 12px; margin: 5px 0 15px; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 6px; box-sizing: border-box; }
  input:focus { border-color: var(--primary); outline: none; }
  
  label { font-size: 0.9rem; color: #aaa; text-transform: uppercase; font-weight: bold; }
  
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  
  button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; }
  button:hover { background: #d62828; }
  button.secondary { background: #333; }
  button.secondary:hover { background: #444; }

  .add-group { display: flex; gap: 10px; }
  .add-group button { width: auto; white-space: nowrap; }
  
  .tags { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
  .tag { background: #333; padding: 5px 10px; border-radius: 4px; font-size: 0.9rem; border: 1px solid #444; }
</style>
</head>
<body>

<div class="container">
  <h1>âœ¨ Novo Personagem</h1>
  
  <div class="card">
    <label>Nome do HerÃ³i</label>
    <input id="nome" placeholder="Ex: Gandalf, o Cinzento">
    
    <label>Imagem (URL)</label>
    <input id="img" placeholder="https://...">

    <label>Classe / ArquÃ©tipo</label>
    <input id="classe" placeholder="Ex: Mago, Guerreiro">
  </div>

  <div class="card">
    <h3>Atributos Base</h3>
    <div class="grid-2">
      <div><label>Vida MÃ¡x</label><input id="vida" type="number" value="10"></div>
      <div><label>Energia MÃ¡x</label><input id="energia" type="number" value="10"></div>
      <div><label>Vigor</label><input id="vigor" type="number" value="5"></div>
      <div><label>Integridade</label><input id="integridade" type="number" value="100"></div>
    </div>
  </div>

  <div class="card">
    <h3>InventÃ¡rio & Habilidades</h3>
    
    <label>Ataques</label>
    <div id="listaAtaques" class="tags"></div>
    <div class="add-group">
      <input id="novoAtaque" placeholder="Novo ataque">
      <button onclick="addToList('ataques', 'novoAtaque', 'listaAtaques')">Adicionar</button>
    </div>
    
    <label style="margin-top:15px; display:block;">Habilidades</label>
    <div id="listaHabs" class="tags"></div>
    <div class="add-group">
      <input id="novaHab" placeholder="Nova habilidade">
      <button onclick="addToList('habilidades', 'novaHab', 'listaHabs')">Adicionar</button>
    </div>
  </div>

  <button onclick="salvar()" style="margin-bottom: 10px;">ðŸ’¾ Salvar Ficha</button>
  <a href="index.html"><button class="secondary">Cancelar</button></a>
</div>

<script type="module">
import { db, auth, addDoc, collection, onAuthStateChanged } from "./firebase.js";

const dados = { ataques: [], habilidades: [] };

// FunÃ§Ã£o global para adicionar itens nas listas visuais
window.addToList = (arrayName, inputId, divId) => {
  const input = document.getElementById(inputId);
  if (!input.value) return;
  
  dados[arrayName].push(input.value);
  input.value = "";
  renderTags(arrayName, divId);
};

function renderTags(arrayName, divId) {
  const container = document.getElementById(divId);
  container.innerHTML = dados[arrayName].map(item => `<span class="tag">${item}</span>`).join("");
}

window.salvar = async function() {
  const user = auth.currentUser;
  if (!user) return alert("VocÃª precisa estar logado!");
  
  const getVal = (id) => Number(document.getElementById(id).value);

  try {
    await addDoc(collection(db, "fichas"), {
      uid: user.uid,
      nome: document.getElementById('nome').value,
      imagem: document.getElementById('img').value,
      classe: document.getElementById('classe').value,
      vida: { atual: getVal('vida'), max: getVal('vida') },
      energia: { atual: getVal('energia'), max: getVal('energia') },
      vigor: { atual: getVal('vigor'), max: getVal('vigor') },
      integridade: { atual: getVal('integridade'), max: getVal('integridade') },
      ataques: dados.ataques,
      habilidades: dados.habilidades
    });
    alert("Personagem criado com sucesso!");
    window.location = "index.html";
  } catch (e) {
    alert("Erro ao salvar: " + e.message);
  }
};
</script>
</body>
</html>
