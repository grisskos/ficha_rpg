<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Ficha</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { background:#111; color:white; font-family:Arial; padding:20px; }
.box { background:#1a1a1a; margin:10px 0; padding:15px; border-radius:10px; }
.bar-bg { background:#333; width:100%; height:20px; border-radius:10px; margin:5px 0; }
.bar { height:20px; border-radius:10px; }
button { padding:8px; }
</style>
</head>

<body>
<h1 id="charNome">Carregando...</h1>
<img id="charImg" width="200">

<div id="stats"></div>

<h2>Ataques</h2>
<div id="ataques"></div>

<h2>Habilidades & Talentos</h2>
<div id="habilidades"></div>

<h2>Feiti√ßos</h2>
<div id="feiticos"></div>

<br><a href="index.html"><button>Voltar</button></a>

<script type="module">
import {
  db, doc, getDoc, updateDoc
} from "./firebase.js";

const params = new URLSearchParams(location.search);
const id = params.get("id");

async function load() {
  const snap = await getDoc(doc(db, "fichas", id));
  const f = snap.data();

  charNome.innerText = f.nome;
  charImg.src = f.imagem;

  renderStat("Vida", f.vida, "vida");
  renderStat("Energia", f.energia, "energia");
  renderStat("Vigor", f.vigor, "vigor");
  renderStat("Integridade", f.integridade, "integridade");

  ataques.innerHTML = f.ataques.map(a => "- " + a).join("<br>");
  habilidades.innerHTML = f.habilidades.map(h => "- " + h).join("<br>");
  feiticos.innerHTML = f.feiticos.map(g => "- " + g).join("<br>");
}

function renderStat(label, dados, campo) {
  stats.innerHTML += `
    <div class="box">
      <h3>${label}: ${dados.atual} / ${dados.max}</h3>
      <div class="bar-bg">
        <div class="bar" style="width:${(dados.atual/dados.max)*100}%;background:red;"></div>
      </div>
      <button onclick="alterar('${campo}', -1)">-</button>
      <button onclick="alterar('${campo}', +1)">+</button>
    </div>
  `;
}

window.alterar = async function(stat, val) {
  const snap = await getDoc(doc(db, "fichas", id));
  const f = snap.data();
  f[stat].atual = Math.max(0, Math.min(f[stat].max, Number(f[stat].atual) + val));
  await updateDoc(doc(db, "fichas", id), f);
  location.reload();
};

load();
</script>

</body>
</html>
