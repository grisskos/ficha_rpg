<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Fichas RPG</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background: #0d0d0d;
  color: white;
  font-family: Arial;
  padding: 20px;
}
.card {
  background: #1a1a1a;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
}
.ficha {
  background: #222;
  padding: 15px;
  margin: 10px 0;
  border-radius: 8px;
}
button {
  padding: 10px;
  margin-top: 10px;
  cursor: pointer;
}
</style>
</head>

<body>
<h1>ðŸ“œ Fichas dos Personagens</h1>

<div id="loginBox" class="card">
  <h2>Login</h2>
  <input id="user" placeholder="UsuÃ¡rio"><br><br>
  <input id="pass" placeholder="Senha" type="password"><br><br>
  <button onclick="login()">Entrar</button>
  <button onclick="criarConta()">Criar Conta</button>
</div>

<div id="userArea" class="card" style="display:none;">
  Logado como: <span id="userEmail"></span><br>
  <button onclick="logout()">Sair</button>
  <a href="create.html"><button>Criar Personagem</button></a>
</div>

<div id="lista"></div>

<script type="module">
import {
  db, auth,
  collection, query, where, onSnapshot,
  onAuthStateChanged, signInWithEmailAndPassword,
  createUserWithEmailAndPassword, signOut
} from "./firebase.js";

onAuthStateChanged(auth, user => {
  if (!user) {
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("userArea").style.display = "none";
    return;
  }

  document.getElementById("loginBox").style.display = "none";
  document.getElementById("userArea").style.display = "block";
  document.getElementById("userEmail").innerText = user.email;

  const q = query(collection(db, "fichas"), where("uid", "==", user.uid));
  onSnapshot(q, snapshot => {
    const lista = document.getElementById("lista");
    lista.innerHTML = "";

    snapshot.forEach(doc => {
      const f = doc.data();
      lista.innerHTML += `
        <div class="ficha">
          <h3>${f.nome}</h3>
          <img src="${f.imagem || ''}" width="150"><br>
          <a href="ficha.html?id=${doc.id}">
            <button>Abrir Ficha</button>
          </a>
        </div>
      `;
    });
  });
});

window.login = function() {
  signInWithEmailAndPassword(auth, user.value + "@fake.com", pass.value)
  .catch(e => alert(e.message));
}

window.criarConta = function() {
  createUserWithEmailAndPassword(auth, user.value + "@fake.com", pass.value)
  .catch(e => alert(e.message));
}

window.logout = function() {
  signOut(auth);
}
</script>
</body>
</html>
