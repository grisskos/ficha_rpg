<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Criar Personagem</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root { --bg: #0f0f0f; --card: #1c1c1c; --primary: #e63946; --text: #f1f1f1; }
  body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 20px; display: flex; justify-content: center; }
  
  .container { width: 100%; max-width: 600px; }
  h1 { border-bottom: 2px solid var(--primary); padding-bottom: 10px; color: var(--primary); }
  
  .card { background: var(--card); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; }
  
  /* Estilo para Inputs e Selects */
  input, select { width: 100%; padding: 12px; margin: 5px 0 15px; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
  input:focus, select:focus { border-color: var(--primary); outline: none; }
  
  label { font-size: 0.8rem; color: #aaa; text-transform: uppercase; font-weight: bold; display: block; margin-bottom: 5px; }
  
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
  
  button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; }
  button:hover { background: #d62828; }
  button.secondary { background: #333; }
  button.secondary:hover { background: #444; }

  .add-group { display: flex; gap: 10px; }
  .tags { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
  .tag { background: #333; padding: 5px 10px; border-radius: 4px; font-size: 0.9rem; border: 1px solid #444; }
</style>
</head>
<body>

<div class="container">
  <h1>‚ú® Novo Personagem</h1>
  
  <div class="card">
    <label>Nome do Her√≥i</label>
    <input id="nome" placeholder="Nome do personagem">
    
    <label>Imagem (URL)</label>
    <input id="img" placeholder="https://...">

    <div class="grid-2">
      <div>
        <label>Classe</label>
        <select id="classe">
          <option value="Lutador">Lutador</option>
          <option value="Especialista em Combate">Especialista em Combate</option>
          <option value="Especialista em T√©cnica">Especialista em T√©cnica</option>
          <option value="Suporte">Suporte</option>
          <option value="Controlador">Controlador</option>
          <option value="Restringido">Restringido</option>
        </select>
      </div>
      <div>
        <label>Origem</label>
        <input id="origem" placeholder="Ex: Inato, Derivado...">
      </div>
    </div>
  </div>

  <div class="card">
    <h3>Atributos Principais (1-30)</h3>
    <div class="grid-3">
      <div><label>For√ßa</label><input id="forca" type="number" value="10"></div>
      <div><label>Destreza</label><input id="destreza" type="number" value="10"></div>
      <div><label>Constitui√ß√£o</label><input id="constituicao" type="number" value="10"></div>
      <div><label>Intelig√™ncia</label><input id="inteligencia" type="number" value="10"></div>
      <div><label>Sabedoria</label><input id="sabedoria" type="number" value="10"></div>
      <div><label>Presen√ßa</label><input id="presenca" type="number" value="10"></div>
    </div>
  </div>

  <div class="card">
    <h3>Barras de Status</h3>
    <div class="grid-2">
      <div><label>Vida M√°x</label><input id="vida" type="number" value="20"></div>
      <div><label>Energia M√°x</label><input id="energia" type="number" value="10"></div>
      <div><label>Vigor M√°x</label><input id="vigor" type="number" value="5"></div>
      <div><label>Integridade M√°x</label><input id="integridade" type="number" value="100"></div>
    </div>
  </div>

  <div class="card">
    <h3>Invent√°rio & Habilidades</h3>
    <label>Ataques</label>
    <div id="listaAtaques" class="tags"></div>
    <div class="add-group">
      <input id="novoAtaque" placeholder="Novo ataque">
      <button onclick="addToList('ataques', 'novoAtaque', 'listaAtaques')">Add</button>
    </div>
    
    <label style="margin-top:15px;">Habilidades</label>
    <div id="listaHabs" class="tags"></div>
    <div class="add-group">
      <input id="novaHab" placeholder="Nova habilidade">
      <button onclick="addToList('habilidades', 'novaHab', 'listaHabs')">Add</button>
    </div>
  </div>

  <button onclick="salvar()" style="margin-bottom: 10px;">üíæ Salvar Ficha</button>
  <a href="index.html"><button class="secondary">Cancelar</button></a>
</div>

<script type="module">
import { db, auth, addDoc, collection } from "./firebase.js";

const dados = { ataques: [], habilidades: [] };

window.addToList = (arrayName, inputId, divId) => {
  const input = document.getElementById(inputId);
  if (!input.value) return;
  dados[arrayName].push(input.value);
  input.value = "";
  renderTags(arrayName, divId);
};

function renderTags(arrayName, divId) {
  document.getElementById(divId).innerHTML = dados[arrayName].map(item => `<span class="tag">${item}</span>`).join("");
}

window.salvar = async function() {
  const user = auth.currentUser;
  if (!user) return alert("Voc√™ precisa estar logado!");
  
  const getVal = (id) => Number(document.getElementById(id).value);

  try {
    await addDoc(collection(db, "fichas"), {
      uid: user.uid,
      nome: document.getElementById('nome').value,
      imagem: document.getElementById('img').value,
      classe: document.getElementById('classe').value, // Agora pega do Select
      origem: document.getElementById('origem').value, // Novo campo
      
      vida: { atual: getVal('vida'), max: getVal('vida') },
      energia: { atual: getVal('energia'), max: getVal('energia') },
      vigor: { atual: getVal('vigor'), max: getVal('vigor') },
      integridade: { atual: getVal('integridade'), max: getVal('integridade') },
      
      atributos: {
        forca: getVal('forca'),
        destreza: getVal('destreza'),
        constituicao: getVal('constituicao'),
        inteligencia: getVal('inteligencia'),
        sabedoria: getVal('sabedoria'),
        presenca: getVal('presenca')
      },
      
      ataques: dados.ataques,
      habilidades: dados.habilidades
    });
    alert("Personagem criado com sucesso!");
    window.location = "index.html";
  } catch (e) {
    alert("Erro ao salvar: " + e.message);
  }
};
</script>
</body>
</html>
